# ğŸ¯ é«˜å°”å¤«è§†é¢‘ä¸‹è½½ API - å¿«é€Ÿéƒ¨ç½²æŒ‡å—

## ğŸ“‹ éƒ¨ç½²æ¦‚è§ˆ

é€šè¿‡ CloudFlare Tunnel å°†è§†é¢‘ä¸‹è½½ API å®‰å…¨æš´éœ²åˆ°å…¬ç½‘ï¼Œä¾›é«˜å°”å¤« App ä½¿ç”¨ã€‚

## ğŸš€ ä¸€é”®éƒ¨ç½²æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šåˆ›å»º CloudFlare Tunnel Token

1. è®¿é—® [CloudFlare Zero Trust Dashboard](https://one.dash.cloudflare.com/)

2. è¿›å…¥ **Access** â†’ **Tunnels** â†’ **Create a tunnel**

3. é€‰æ‹© **Cloudflared**ï¼Œåˆ›å»ºåä¸º `golf-video-api` çš„ tunnel

4. **å¤åˆ¶ Tunnel Token**ï¼ˆå¾ˆé•¿çš„ä¸€ä¸²å­—ç¬¦ï¼‰

5. åœ¨ CloudFlare é…ç½® **Public Hostname**ï¼š
   - **Subdomain**: `golf-video-api`ï¼ˆæˆ–ä½ å–œæ¬¢çš„åå­—ï¼‰
   - **Domain**: é€‰æ‹©ä½ çš„åŸŸå
   - **Service Type**: `HTTP`
   - **URL**: `video_downloader_api:80`
   - ç‚¹å‡» **Save hostname**

### ç¬¬äºŒæ­¥ï¼šé…ç½® Token

1. åœ¨é¡¹ç›®ç›®å½•åˆ›å»º `.env` æ–‡ä»¶ï¼ˆå¤åˆ¶ä¸‹é¢å†…å®¹ï¼‰ï¼š

```env
TUNNEL_TOKEN=ç²˜è´´ä½ çš„CloudFlare_Tunnel_Token
```

### ç¬¬ä¸‰æ­¥ï¼šè¿è¡Œéƒ¨ç½²

åŒå‡»è¿è¡Œ `éƒ¨ç½²è„šæœ¬.bat`

ç­‰å¾…æœåŠ¡å¯åŠ¨å®Œæˆï¼ˆçº¦ 1-2 åˆ†é’Ÿï¼‰

## âœ… éªŒè¯éƒ¨ç½²

è®¿é—®ä»¥ä¸‹åœ°å€æµ‹è¯•ï¼š

- **æœ¬åœ°**: http://localhost:8081/docs
- **å…¬ç½‘**: https://golf-video-api.ä½ çš„åŸŸå.com/docs

çœ‹åˆ° API æ–‡æ¡£é¡µé¢å³éƒ¨ç½²æˆåŠŸï¼

## ğŸ“± é«˜å°”å¤« App é›†æˆ

åœ¨ä½ çš„é«˜å°”å¤« App ä¸­ä½¿ç”¨ï¼š

```
åŸºç¡€ URL: https://golf-video-api.ä½ çš„åŸŸå.com

è§†é¢‘è§£ææ¥å£: POST /api/hybrid/video_data
è¯·æ±‚ä½“: {"url": "è§†é¢‘é“¾æ¥"}
```

### æ”¯æŒçš„å¹³å°

- âœ… æŠ–éŸ³ï¼ˆDouyinï¼‰
- âœ… TikTok
- âœ… å“”å“©å“”å“©ï¼ˆBilibiliï¼‰

### ç¤ºä¾‹è¯·æ±‚

```bash
curl -X POST "https://golf-video-api.ä½ çš„åŸŸå.com/api/hybrid/video_data" \
  -H "Content-Type: application/json" \
  -d '{"url": "æŠ–éŸ³/TikTok/Bç«™è§†é¢‘é“¾æ¥"}'
```

## ğŸ”§ ç®¡ç†è„šæœ¬

| è„šæœ¬ | åŠŸèƒ½ |
|------|------|
| `éƒ¨ç½²è„šæœ¬.bat` | ä¸€é”®éƒ¨ç½²æœåŠ¡ |
| `åœæ­¢æœåŠ¡.bat` | åœæ­¢æ‰€æœ‰æœåŠ¡ |
| `é‡å¯æœåŠ¡.bat` | é‡å¯æœåŠ¡ |
| `æŸ¥çœ‹æ—¥å¿—.bat` | å®æ—¶æŸ¥çœ‹æ—¥å¿— |
| `æµ‹è¯•æœåŠ¡.bat` | æµ‹è¯•æœåŠ¡æ˜¯å¦æ­£å¸¸ |

## ğŸ’¡ Docker Desktop è‡ªåŠ¨å¯åŠ¨

### é…ç½®æ–¹æ³•ï¼š

1. æ‰“å¼€ **Docker Desktop**

2. è¿›å…¥ **Settings** â†’ **General**

3. å‹¾é€‰ï¼š
   - âœ… **Start Docker Desktop when you log in**
   - âœ… **Automatically check for updates**

4. è¿›å…¥ **Resources**ï¼š
   - **CPUs**: å»ºè®®è‡³å°‘ 2 æ ¸
   - **Memory**: å»ºè®®è‡³å°‘ 4GB

### æœåŠ¡è‡ªåŠ¨è¿è¡Œ

éƒ¨ç½²åï¼ŒæœåŠ¡ä¼šï¼š
- âœ… Docker Desktop å¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œ
- âœ… å®¹å™¨å´©æºƒæ—¶è‡ªåŠ¨é‡å¯ï¼ˆ`restart: always`ï¼‰
- âœ… å¥åº·æ£€æŸ¥è‡ªåŠ¨ç›‘æ§

## ğŸ”’ å®‰å…¨å»ºè®®

### 1. CloudFlare é™æµ

åœ¨ CloudFlare Dashboardï¼š
- **Security** â†’ **WAF** â†’ **Rate limiting rules**
- å»ºè®®ï¼šé™åˆ¶æ¯ä¸ª IP æ¯åˆ†é’Ÿ 100 æ¬¡è¯·æ±‚

### 2. IP ç™½åå•ï¼ˆå¯é€‰ï¼‰

åœ¨ CloudFlare Zero Trustï¼š
- **Access** â†’ **Applications** â†’ **Add an application**
- é…ç½®åªå…è®¸ç‰¹å®š IP æˆ–å›½å®¶è®¿é—®

### 3. API å¯†é’¥ï¼ˆå¯é€‰ï¼‰

ç¼–è¾‘ `config.yaml`ï¼š

```yaml
API:
  API_Key: "ä½ çš„è‡ªå®šä¹‰å¯†é’¥"
```

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€

```bash
wsl docker-compose -f docker-compose.cloudflare.yml ps
```

### æŸ¥çœ‹æ—¥å¿—

è¿è¡Œ `æŸ¥çœ‹æ—¥å¿—.bat` æˆ–ï¼š

```bash
wsl docker-compose -f docker-compose.cloudflare.yml logs -f
```

### æ¸…ç†ä¸‹è½½æ–‡ä»¶

ä¸‹è½½æ–‡ä»¶å­˜å‚¨åœ¨ `./download` ç›®å½•ï¼Œå»ºè®®å®šæœŸæ¸…ç†ï¼š

```bash
# åœ¨ WSL ä¸­æ‰§è¡Œ
find download/ -type f -mtime +1 -delete
```

## ğŸ› æ•…éšœæ’æŸ¥

### Tunnel è¿æ¥å¤±è´¥

```bash
# æŸ¥çœ‹ Tunnel æ—¥å¿—
wsl docker logs golf_cloudflare_tunnel

# æ£€æŸ¥ Token æ˜¯å¦æ­£ç¡®
notepad .env
```

### API æ— å“åº”

```bash
# æŸ¥çœ‹ API æ—¥å¿—
wsl docker logs golf_video_downloader_api

# é‡å¯æœåŠ¡
è¿è¡Œ é‡å¯æœåŠ¡.bat
```

### ç«¯å£è¢«å ç”¨

```bash
# Windows æŸ¥çœ‹ç«¯å£å ç”¨
netstat -ano | findstr :8081

# æ€æ­»è¿›ç¨‹ï¼ˆPID ä»ä¸Šé¢è·å–ï¼‰
taskkill /PID è¿›ç¨‹ID /F
```

## ğŸ”„ æ›´æ–°æœåŠ¡

```bash
# åœ¨ WSL ä¸­æ‰§è¡Œ
cd /Ubuntu-22.04/home/huxiaoran/projects/MyVideoDownloader/MyVideoDownloder

# æ‹‰å–æœ€æ–°ä»£ç 
git pull

# é‡æ–°éƒ¨ç½²
è¿è¡Œ éƒ¨ç½²è„šæœ¬.bat
```

## ğŸ“ å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨
wsl docker ps -a

# è¿›å…¥ API å®¹å™¨
wsl docker exec -it golf_video_downloader_api bash

# å®Œå…¨æ¸…ç†å¹¶é‡æ–°éƒ¨ç½²
wsl docker-compose -f docker-compose.cloudflare.yml down -v
è¿è¡Œ éƒ¨ç½²è„šæœ¬.bat
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **åˆæ³•ä½¿ç”¨**ï¼šä»…ç”¨äºå­¦ä¹ å’Œåˆæ³•ç”¨é€”
2. **æµé‡æ§åˆ¶**ï¼šåœ¨ CloudFlare é…ç½®é™æµï¼Œé˜²æ­¢æ»¥ç”¨
3. **æ•°æ®æ¸…ç†**ï¼šå®šæœŸæ¸…ç† download ç›®å½•
4. **å®‰å…¨æ›´æ–°**ï¼šå®šæœŸæ›´æ–°é•œåƒ
5. **å¤‡ä»½é…ç½®**ï¼šå¤‡ä»½ `.env` å’Œ `config.yaml`

## ğŸ¯ éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] CloudFlare Tunnel å·²åˆ›å»º
- [ ] Public Hostname å·²é…ç½®
- [ ] `.env` æ–‡ä»¶å·²åˆ›å»ºå¹¶å¡«å…¥ Token
- [ ] Docker Desktop å·²å¯åŠ¨
- [ ] è¿è¡Œ `éƒ¨ç½²è„šæœ¬.bat`
- [ ] æœ¬åœ°è®¿é—®æµ‹è¯•é€šè¿‡
- [ ] å…¬ç½‘è®¿é—®æµ‹è¯•é€šè¿‡
- [ ] é«˜å°”å¤« App èƒ½æˆåŠŸè°ƒç”¨
- [ ] Docker Desktop è‡ªåŠ¨å¯åŠ¨å·²å¼€å¯

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- API æ–‡æ¡£ï¼šè®¿é—® `/docs` ç«¯ç‚¹
- é¡¹ç›®åœ°å€ï¼š[Douyin_TikTok_Download_API](https://github.com/Evil0ctal/Douyin_TikTok_Download_API)

---

## ğŸ‰ å®Œæˆï¼

ä½ çš„é«˜å°”å¤«è§†é¢‘ä¸‹è½½ API ç°åœ¨å·²ç»ï¼š
- âœ… å®‰å…¨æš´éœ²åˆ°å…¬ç½‘
- âœ… Docker Desktop æŒç»­è¿è¡Œ
- âœ… è‡ªåŠ¨é‡å¯å’Œå¥åº·æ£€æŸ¥
- âœ… å¯ä¾›é«˜å°”å¤« App è°ƒç”¨

è®¿é—® API æ–‡æ¡£å¼€å§‹ä½¿ç”¨ï¼

