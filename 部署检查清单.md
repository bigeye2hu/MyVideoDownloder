# 高尔夫视频下载 API - 部署检查清单

## ✅ 部署前检查

### 1. 环境准备
- [ ] 已安装 Docker Desktop for Windows
- [ ] 已安装 WSL 2
- [ ] 已安装 Ubuntu 22.04 (在 WSL 中)
- [ ] Docker Desktop 已启用 WSL 2 集成

### 2. CloudFlare 账号
- [ ] 已注册 CloudFlare 账号
- [ ] 已添加域名到 CloudFlare（如果需要自定义域名）
- [ ] 可以访问 CloudFlare Zero Trust Dashboard

## 📋 部署步骤

### 步骤 1: 获取 CloudFlare Tunnel Token

- [ ] 访问 https://one.dash.cloudflare.com/
- [ ] 导航到 Networks → Tunnels
- [ ] 创建新 Tunnel（名称：golf-video-api）
- [ ] 复制 Token（保存到安全位置）

**Token 示例格式：**
```
eyJhIjoiMTIzNDU2Nzg5MGFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6..."
```

### 步骤 2: 配置环境变量

- [ ] 在 `MyVideoDownloder` 目录创建 `.env` 文件
- [ ] 将以下内容复制到 `.env` 文件：

```env
TUNNEL_TOKEN=你的实际Token
TZ=Asia/Shanghai
```

- [ ] 确认 Token 已正确粘贴（无空格、无换行）

### 步骤 3: 启动服务

- [ ] 方式 A：双击 `Windows启动.bat`
- [ ] 或方式 B：在 WSL 中运行 `./部署到高尔夫.sh`
- [ ] 等待服务启动（约 30-60 秒）
- [ ] 看到 "部署完成！" 提示

### 步骤 4: 验证本地服务

- [ ] 访问 http://localhost:8081/docs
- [ ] 页面正常加载，显示 API 文档
- [ ] 运行 `Windows测试服务.bat` 确认所有测试通过

### 步骤 5: 配置公网访问

回到 CloudFlare Tunnel Dashboard：

- [ ] 找到刚创建的 Tunnel
- [ ] 点击 "Configure"
- [ ] 在 "Public Hostname" 部分点击 "Add a public hostname"
- [ ] 配置如下：
  - Subdomain: `golf-api`（或你喜欢的名字）
  - Domain: 选择你的域名
  - Service Type: `HTTP`
  - URL: `golf_video_api:80`（重要：不是 localhost）
- [ ] 点击 "Save hostname"

### 步骤 6: 验证公网访问

- [ ] 访问 `https://golf-api.你的域名.com/docs`
- [ ] 页面正常加载
- [ ] 测试 API 调用：

```bash
curl -X POST "https://golf-api.你的域名.com/api/hybrid/video_data" \
  -H "Content-Type: application/json" \
  -d '{"url": "https://v.douyin.com/iJsyErwJ/"}'
```

- [ ] 返回 JSON 响应（包含视频信息）

## 🎯 高尔夫 App 集成

### 在 App 中配置

- [ ] 设置 API Base URL：`https://golf-api.你的域名.com`
- [ ] 测试视频解析功能
- [ ] 测试视频下载功能
- [ ] 确认不同平台（抖音、TikTok、B站）都能正常工作

### 测试链接

可以使用以下测试链接验证：

**抖音：**
```
https://v.douyin.com/iJsyErwJ/
```

**TikTok：**
```
https://www.tiktok.com/@zachking/video/6768504823336815877
```

**B站：**
```
https://www.bilibili.com/video/BV1xx411c7BK
```

## 🔧 持续运行检查

### Docker Desktop 设置

- [ ] 打开 Docker Desktop
- [ ] Settings → General
- [ ] 勾选 "Start Docker Desktop when you log in"
- [ ] 勾选 "Use Docker Compose V2"
- [ ] Settings → Resources → WSL Integration
- [ ] 启用 Ubuntu-22.04

### 容器自动重启

- [ ] 运行 `docker-compose -f docker-compose.golf.yml ps`
- [ ] 确认 Restart Policy 为 "always"

### 测试开机自启

- [ ] 重启 Windows
- [ ] 等待 Docker Desktop 启动
- [ ] 运行 `Windows查看状态.bat`
- [ ] 确认容器自动运行

## 📊 监控和维护

### 日常检查（建议每周）

- [ ] 检查服务状态：`Windows查看状态.bat`
- [ ] 查看错误日志：`Windows查看日志.bat`
- [ ] 测试 API 功能：`Windows测试服务.bat`
- [ ] 检查磁盘空间：`download` 目录大小

### 定期维护（建议每月）

- [ ] 清理下载文件：
```bash
wsl -d Ubuntu-22.04 bash -c "cd ~/projects/MyVideoDownloader/MyVideoDownloder && rm -rf download/*"
```

- [ ] 清理旧日志：
```bash
wsl -d Ubuntu-22.04 bash -c "cd ~/projects/MyVideoDownloader/MyVideoDownloder && find logs/ -name '*.log' -mtime +30 -delete"
```

- [ ] 更新服务（如有新版本）：
```bash
wsl -d Ubuntu-22.04 bash -c "cd ~/projects/MyVideoDownloader/MyVideoDownloder && git pull && docker-compose -f docker-compose.golf.yml up -d --build"
```

## 🔒 安全检查

### CloudFlare 安全设置

- [ ] 配置 Rate Limiting（限制请求频率）
- [ ] 启用 WAF 规则（可选）
- [ ] 配置 Access 策略（可选，限制访问来源）

### API 安全

- [ ] 考虑启用 API Key 验证（编辑 `config.yaml`）
- [ ] 记录和监控 API 调用
- [ ] 设置合理的超时时间

## 📝 文档记录

### 保存重要信息

- [ ] CloudFlare Tunnel Token（安全保存）
- [ ] 公网域名：`https://golf-api.你的域名.com`
- [ ] 部署日期：________________
- [ ] 配置的域名：________________
- [ ] 负责人：________________

### 备份

- [ ] 备份 `.env` 文件（不要提交到 Git）
- [ ] 备份 `config.yaml`
- [ ] 记录 CloudFlare 配置

## ✅ 部署完成确认

全部完成后，确认以下几点：

- [ ] ✅ 本地可访问：http://localhost:8081/docs
- [ ] ✅ 公网可访问：https://golf-api.你的域名.com/docs
- [ ] ✅ API 测试通过
- [ ] ✅ 高尔夫 App 可正常调用
- [ ] ✅ 服务自动重启已配置
- [ ] ✅ Docker Desktop 开机自启已启用
- [ ] ✅ 监控和维护计划已建立

## 🎉 完成！

恭喜！你的高尔夫视频下载 API 已成功部署。

### 快速访问

- **本地 API 文档**: http://localhost:8081/docs
- **公网 API 文档**: https://golf-api.你的域名.com/docs
- **管理面板**: 双击 `管理面板.bat`

### 常用命令

```bash
# 查看状态
Windows查看状态.bat

# 查看日志
Windows查看日志.bat

# 测试服务
Windows测试服务.bat

# 管理面板（推荐）
管理面板.bat
```

### 获取帮助

如遇到问题，请查看：
1. `快速部署-高尔夫.md` - 快速部署指南
2. `高尔夫API使用指南.md` - 完整使用文档
3. 故障排查部分

---

**部署日期：** _______________  
**部署人员：** _______________  
**备注：** _______________

